Select EventHubSource.vin, BlobSource.Model, EventHubSource.timestamp, EventHubSource.outsideTemperature, EventHubSource.engineTemperature, EventHubSource.speed, EventHubSource.fuel, EventHubSource.engineoil, EventHubSource.tirepressure, EventHubSource.odometer, EventHubSource.city, EventHubSource.accelerator_pedal_position, EventHubSource.parking_brake_status,EventHubSource.headlamp_status, EventHubSource.brake_pedal_status, EventHubSource.transmission_gear_position, EventHubSource.ignition_status, EventHubSource.windshield_wiper_status, EventHubSource.abs 

into BlobSink 
rom EventHubSource 
join BlobSource on EventHubSource.vin = BlobSource.VIN



Select 
   EventHubSource.vin, 
   BlobSource.Model, 
   EventHubSource.timestamp,
   EventHubSource.outsideTemperature, 
   EventHubSource.engineTemperature, 
   EventHubSource.speed,
   EventHubSource.fuel, 
   EventHubSource.engineoil, 
   EventHubSource.tirepressure, 
   EventHubSource.odometer,
   EventHubSource.city, 
   EventHubSource.accelerator_pedal_position,    EventHubSource.parking_brake_status,
   EventHubSource.headlamp_status,       EventHubSource.brake_pedal_status,
   EventHubSource.transmission_gear_position,       EventHubSource.ignition_status,
   EventHubSource.windshield_wiper_status, 
   EventHubSource.abs 
into EventHubOut 
from EventHubSource 
join BlobSource on EventHubSource.vin = BlobSource.VIN




Select BlobSource.Model, EventHubSource.city,
   count(vin) as cars, 
   avg(EventHubSource.engineTemperature) as engineTemperature, 
   avg(EventHubSource.speed) as Speed, 
   avg(EventHubSource.fuel) as Fuel, 
   avg(EventHubSource.engineoil) as EngineOil,
   avg(EventHubSource.tirepressure) as TirePressure, 
   avg(EventHubSource.odometer) as Odometer 
into SQLSink 
from EventHubSource 
join BlobSource on EventHubSource.vin = BlobSource.VIN 
group by BlobSource.model, EventHubSource.city, TumblingWindow(second,3)


